<!DOCTYPE html>
<html lang="en" xmlns:c="">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <title>Dashboard - Ace Admin</title>

    <meta name="description" content="overview &amp; stats" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

    <!-- Bootstrap & FontAwesome -->
    <!-- Stylesheets -->
    <link rel="stylesheet" th:href="@{/admin/assets/css/bootstrap.min.css}" />
    <link rel="stylesheet" th:href="@{/admin/assets/font-awesome/4.2.0/css/font-awesome.min.css}" />

    <!-- Page Specific Plugin Styles -->
    <!-- Text Fonts -->
    <link rel="stylesheet" th:href="@{/admin/assets/fonts/fonts.googleapis.com.css}" />

    <!-- ACE Styles -->
    <link rel="stylesheet" th:href="@{/admin/assets/css/ace.min.css}" class="ace-main-stylesheet" id="main-ace-style" />
    <!-- Conditional Stylesheets for IE9 and below -->
    <!--[if lte IE 9]>
    <link rel="stylesheet" th:href="@{/admin/assets/css/ace-part2.min.css}" class="ace-main-stylesheet" />
    <![endif]-->
    <!--[if lte IE 9]>
    <link rel="stylesheet" th:href="@{/admin/assets/css/ace-ie.min.css}" />
    <![endif]-->

    <!-- ACE Settings Handler -->
    <script th:src="@{/admin/assets/js/ace-extra.min.js}"></script>

    <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->
    <!--[if lte IE 8]>
    <script th:src="@{/admin/assets/js/html5shiv.min.js}"></script>
    <script th:src="@{/admin/assets/js/respond.min.js}"></script>
    <![endif]-->
    <style>
        body {
            font-family: 'PT Serif', 'Times New Roman', serif;
        }
        .custom-modal {
            width: 1000px; /* Adjust width */
            height: 90vh; /* Adjust height */
            max-width: 900px;
        }
        .alert-fixed {
            position: fixed;
            top: 10px;            /* Adjusted to have some margin from the top */
            right: 10px;          /* Aligns the alert to the right */
            width: 80%;           /* Adjusted width */
            max-width: 400px;      /* Optional: limits the width of the alert */
            height: 60px;          /* Set a custom height */
            z-index: 1050;
            font-weight: bold;     /* Makes the font bold */
            display: flex;
            align-items: center;   /* Vertically center the content */
            padding-left: 20px;    /* Padding inside the alert box */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Adds a shadow for better aesthetics */
            background-color: #dff0d8; /* Success alert background */
            color: #3c763d;       /* Success alert text color */
            border-radius: 5px;    /* Rounded corners */
        }

        .alert-fixed .close-btn {
            margin-left: auto;     /* Pushes the close button to the far right */
            padding: 0 15px;
            font-size: 20px;
            cursor: pointer;
        }
        .modal-body {

            overflow-y: auto;
        }
    </style>
</head>

<div class="alert alert-fixed" role="alert" id="postResultDiv" th:style="'display: ' + (${alertMessage != null} ? 'block' : 'none') + ';'">
    <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:">
        <use xlink:href="#check-circle-fill"></use>
    </svg>
    <div id="alertMessage" th:text="${alertMessage}"></div>
    <span class="close-btn" onclick="$('#postResultDiv').fadeOut();">&times;</span>
</div>
<body class="no-skin">
<div id="navbar" class="navbar navbar-default">
    <script type="text/javascript">
        try{ace.settings.check('navbar' , 'fixed')}catch(e){}
    </script>

    <div class="navbar-container" id="navbar-container">
        <button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler" data-target="#sidebar">
            <span class="sr-only">Toggle sidebar</span>

            <span class="icon-bar"></span>

            <span class="icon-bar"></span>

            <span class="icon-bar"></span>
        </button>

        <div class="navbar-header pull-left">
            <a href="/patients" class="navbar-brand">
                <small>
                    <i class="fa fa-leaf"></i>
                    Hospital Management
                </small>
            </a>
        </div>

        <div class="navbar-buttons navbar-header pull-right" role="navigation">
            <ul class="nav ace-nav">


                <li class="light-blue">
                    <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                        <img class="nav-user-photo"
                             th:src="@{/admin/assets/avatars/user.jpg}"
                             alt="Jason's Photo" />
                        <span class="user-info">
									<small>Welcome,</small>
									Jason
								</span>

                        <i class="ace-icon fa fa-caret-down"></i>
                    </a>


                    <ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                        <li>
                            <a href="#">
                                <i class="ace-icon fa fa-cog"></i>
                                Settings
                            </a>
                        </li>

                        <li>
                            <a href="profile.html">
                                <i class="ace-icon fa fa-user"></i>
                                Profile
                            </a>
                        </li>

                        <li class="divider"></li>

                        <li>
                            <a href="#">
                                <i class="ace-icon fa fa-power-off"></i>
                                Logout
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div><!-- /.navbar-container -->
</div>

<div class="main-container" id="main-container">
    <script type="text/javascript">
        try{ace.settings.check('main-container' , 'fixed')}catch(e){}
    </script>

    <div id="sidebar" class="sidebar                  responsive">
        <script type="text/javascript">
            try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
        </script>


        <!-- /.sidebar-shortcuts -->

        <ul class="nav nav-list">
            <li class="active">
                <a href="/patients">
                    <i class="menu-icon fa fa-tachometer"></i>
                    <span class="menu-text"> Patient </span>
                </a>

                <b class="arrow"></b>
            </li>

        </ul><!-- /.nav-list -->

        <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
            <i class="ace-icon fa fa-angle-double-left" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
        </div>

        <script type="text/javascript">
            try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
        </script>
    </div>

    <div class="main-content">
        <div class="main-content-inner">
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
                </script>
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a href="#1a" data-toggle="tab">Thông tin</a>
                    </li>
                    <li><a href="#2a" data-toggle="tab">Lịch sử khám bệnh</a></li>
                    <li><a href="#3a" data-toggle="tab">Đăng ký nhập viện</a></li>

                </ul>

                <br>
<!--                <ul class="breadcrumb">-->

<!--                    <li class="active">Management</li>-->
<!--                </ul>&lt;!&ndash; /.breadcrumb &ndash;&gt;-->

<!--                <div class="nav-search" id="nav-search">-->
<!--                    <form class="form-search">-->
<!--								<span class="input-icon">-->
<!--									<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />-->
<!--									<i class="ace-icon fa fa-search nav-search-icon"></i>-->
<!--								</span>-->
<!--                    </form>-->
<!--                </div>&lt;!&ndash; /.nav-search &ndash;&gt;-->
            </div>





            <div id="exTab1"class="container-fluid">
                <div class="tab-content clearfix">
                    <!-- Tab 1: Overview -->
                    <div class="tab-pane active" id="1a">


                        <form >
                            <div class="row">
                                <!-- Full Name -->
                                <div class="col-md-9">
                                    <div class="mb-3">
                                        <label for="name" class="form-label">Họ và Tên</label>
                                        <input type="text" class="form-control" id="name" name="name" placeholder="Enter full name" required>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Gender:</label>
                                        <div class="form-check">
                                            <input type="radio" class="form-check-input" name="gender" id="male" value="Nam" checked>
                                            <label class="form-check-label" for="male">Nam</label>
                                                <input type="radio" class="form-check-input" name="gender" id="female" value="Nữ">
                                                <label class="form-check-label" for="female">Nữ</label>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <!-- City ID -->
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="cityId" class="form-label">City ID</label>
                                        <input type="number" class="form-control" id="cityId" name="cityId" placeholder="City ID" readonly>
                                    </div>
                                </div>

                                <!-- District ID -->
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="districtId" class="form-label">District ID</label>
                                        <input type="number" class="form-control" id="districtId" name="districtId" placeholder="District ID" readonly>
                                    </div>
                                </div>

                                <!-- Ward ID -->
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="wardId" class="form-label">Ward ID</label>
                                        <input type="number" class="form-control" id="wardId" name="wardId" placeholder="Ward ID" readonly>
                                    </div>
                                </div>

                                <!-- Street -->
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="street" class="form-label">Street</label>
                                        <input type="text" class="form-control" id="street" name="street" placeholder="Street Address" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <!-- Date of Birth -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="dob" class="form-label">Date of Birth</label>
                                        <input type="date" class="form-control" id="dob" name="dob" required>
                                    </div>
                                </div>

                                <!-- Phone Number -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="phoneNumber" class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" placeholder="Phone Number" required>
                                    </div>
                                </div>
                            </div>
<br>
                            <!-- Submit Button -->
                            <div class="row">
                                <div class="col-md-12 text-center">
                                    <button type="submit" class="btn btn-primary">Save</button>
                                </div>
                            </div>
                        </form>



                    </div>

                    <!-- Tab 2: Using nav-pills -->
                    <div class="tab-pane " id="2a">
                        <div class="row">
                            <div class="col-xs-12">
                                <table id="myTable" class="table table-striped table-bordered table-hover">
                                    <!--                                    <div id="dynamic-table_wrapper" class="dataTables_wrapper form-inline no-footer"><div class="row"><div class="col-xs-6"><div class="dataTables_length" id="dynamic-table_length"><label>Display <select name="dynamic-table_length" aria-controls="dynamic-table" class="form-control input-sm" jf-ext-cache-id="28"><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> records</label></div></div><div class="col-xs-6"><div id="dynamic-table_filter" class="dataTables_filter"><label>Search:<input type="search" class="form-control input-sm" placeholder="" aria-controls="dynamic-table" jf-ext-cache-id="15"></label></div></div></div><table id="dynamic-table" class="table table-striped table-bordered table-hover dataTable no-footer DTTT_selectable" role="grid" aria-describedby="dynamic-table_info">-->

                                    <thead>
                                    <tr>
                                        <th style="width: 50px;text-align: center;">STT</th>
                                        <th style="width: 40px;text-align: center;">Xử Lý</th>
                                        <th style="width: 80px;text-align: center;">Ngày khám</th>
                                        <th style="width: 80px;text-align: center;">Ngày tái khám </th>
                                        <th style="width: 90px;text-align: center;" class="hidden-480"> Bác Sĩ</th>
                                        <th style="width: 100px;text-align: center;">Phí khám</th>


                                    </tr>
                                    </thead>
                                    <tbody>
                                    <!-- Iterate over the patients list -->
                                    <tr th:each="examination, iterStat : ${examinations}">
                                        <td th:text="${iterStat.count}" style="text-align: center;"></td><!-- Row number -->
                                        <td>
                                            <div class="btn-group">

                                                <button data-toggle="dropdown" class="btn btn-sm btn-primary dropdown-toggle" jf-ext-button-ct="danger" aria-expanded="false">
                                                    <i class="ace-icon fa fa-cog "></i>

                                                    <i class="ace-icon fa fa-angle-down icon-on-right"></i>
                                                </button>

                                                <ul class="dropdown-menu dropdown-primary">


                                                    <li>
                                                        <a href="#" data-toggle="modal" th:data-target="${'#editExaminationModal' + examination.ID}">
                                                            <i class="ace-icon fa fa-pencil "></i> Chi tiết
                                                        </a>
                                                    </li>


                                                    <li>
                                                        <a href="#">
                                                            <i class="ace-icon fa fa-trash-o "></i>
                                                            Xóa
                                                        </a>
                                                    </li>


                                                </ul>

                                                <div class="modal fade" th:id="${'editExaminationModal' + examination.ID}" tabindex="-1" role="dialog" aria-labelledby="'modalLabel' + ${examination.ID}" aria-hidden="true">
                                                    <div class="modal-dialog" role="document">
                                                        <div class="modal-content">
                                                            <form th:action="@{/editExamination(id=${examination.ID})}" method="post">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" th:id="'modalLabel' + ${examination.ID}">Edit Examination </h5>
                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                        <span aria-hidden="true">&times;</span>
                                                                    </button>
                                                                </div>


                                                                <div class="modal-body">
                                                                    <!-- Hidden input for Examination ID -->
                                                                    <input type="hidden" name="examinationId" th:value="${examination.ID}" />



                                                                    <div class="form-group">
                                                                        <label  for="doctorId">Bác sĩ:</label>

                                                                            <select class="chosen-select form-control" id="doctorId" name="doctorId" required>
                                                                                <option value="">...</option>
                                                                                <option th:each="doctor : ${doctors}"
                                                                                        th:value="${doctor.ID}"
                                                                                        th:text="${'Bs. ' + doctor.firstName + ' ' + doctor.lastName}"
                                                                                        th:selected="${doctor.ID == examination.doctor.ID }">
                                                                                </option>
                                                                            </select>
                                                                    </div>

                                                                    <div class="form-group">
                                                                        <label for="examinationDate">Ngày khám</label>
                                                                        <input type="date" class="form-control" th:value="${#dates.format(examination.examinationDate, 'yyyy-MM-dd')}" id="examinationDate" name="examinationDate" required />
                                                                    </div>

                                                                    <div class="form-group">
                                                                        <label for="diagnosis">Chẩn Đoán:</label>
                                                                        <input type="text" class="form-control" th:value="${examination.diagnosis}" id="diagnosis" name="diagnosis" required />
                                                                    </div>

                                                                    <div class="form-group">

                                                                        <label for="nextExaminationDate">Ngày tái khám</label>
                                                                        <input type="date" class="form-control" th:value="${#dates.format(examination.nextExaminationDate, 'yyyy-MM-dd')}" id="nextExaminationDate" name="nextExaminationDate" />
                                                                    </div>






                                                                        <select id="medicationTemplate"   style="display: none;">
                                                                            <option value="">Chọn thuốc</option>
                                                                            <option th:each="medical : ${medications}"
                                                                                    th:value="${medical.ID}"
                                                                                    th:data-price="${medical.price}"
                                                                                    th:text="${medical.name + '-' + medical.effect}">
                                                                            </option>
                                                                        </select>

                                                                            <table class="table table-bordered medicationTable">
                                                                                <thead class="thead-light">
                                                                                <tr >
                                                                                    <th>Tên thuốc</th>
                                                                                    <th>Giá</th>

                                                                                    <th>Số lượng</th>
                                                                                    <th> <button type="button" class="btn btn-primary btn-sm" th:attr="onclick='addNewRow(' + ${examination.ID} + ');'">Thêm mới</button></th>
                                                                                </tr>
                                                                                </thead>
                                                                                <tbody th:id="'medicationBody-' + ${examination.ID}">
                                                                                <tr th:each="examinationMedication : ${examination.examinationMedications}">
                                                                                    <td>
                                                                                        <select class="chosen-select form-control" name="medicationId" data-placeholder="Chọn thuốc" onchange="updatePrice(this)">
                                                                                            <option value="">Chọn thuốc</option>
                                                                                            <option th:each="medical : ${medications}"
                                                                                                    th:value="${medical.ID}"
                                                                                                    th:data-price="${medical.price}"
                                                                                                    th:text="${medical.name + '-' + medical.effect}"
                                                                                                    th:selected="${medical.ID == examinationMedication.medication.ID}">
                                                                                            </option>
                                                                                        </select>
                                                                                    </td>
                                                                                    <td>
                                                                                        <input type="number" class="form-control" name="price" th:value="${examinationMedication.price}" placeholder="Enter Price">
                                                                                    </td>
                                                                                    <td>
                                                                                        <input type="number" class="form-control" name="quantity" th:value="${examinationMedication.quantity}" placeholder="Enter Quantity">
                                                                                    </td>
                                                                                    <td>
                                                                                        <button type="button" class="btn btn-danger btn-sm remove-row" onclick="removeRow(this)">Xóa</button>
                                                                                    </td>
                                                                                </tr>
                                                                                </tbody>
                                                                            </table>




                                                                    <div class="form-group">
                                                                        <label for="fee">Phí khám</label>
                                                                        <input type="number" step="0.01" class="form-control"  th:value="${examination.fee}" id="fee" name="fee"  />
                                                                    </div>

                                                                    <div class="form-group">
                                                                        <label for="total">Tổng phí khám</label>
                                                                        <input type="number" step="0.01" class="form-control" id="total" name="total" required oninput="calculateFeeExamination()" />
                                                                    </div>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                                    <button type="button" class="btn btn-primary" th:attr="onclick='getFormDataAndSubmit(' + ${examination.ID} + ')'">Save changes</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </td>
                                        <td style="text-align: center;" th:text="${#dates.format(examination.examinationDate, 'dd-MM-yyyy')}" ></td> <!-- Patient name -->
                                        <td style="text-align: center;" th:text="${#dates.format(examination.nextExaminationDate, 'dd-MM-yyyy')}"></td> <!-- Patient gender -->
                                        <td style="text-align: left;" class="hidden-480" th:text="${'Bs.' +' '+ examination.doctor.firstName + ' ' + examination.doctor.lastName }"></td> <!-- Birth date formatted -->
                                        <td style="text-align: right;" th:text="${examination.fee}"></td> <!-- Address -->

                                    </tr>
                                    </tbody>
                                </table>
                                <br>

                                <!--                                <div class="row"><div class="col-xs-6"><div class="dataTables_info" id="dynamic-table_info" role="status" aria-live="polite">Showing 1 to 10 of 23 entries</div></div><div class="col-xs-6"><div class="dataTables_paginate paging_simple_numbers" id="dynamic-table_paginate"><ul class="pagination"><li class="paginate_button previous disabled" aria-controls="dynamic-table" tabindex="0" id="dynamic-table_previous"><a href="#">Previous</a></li><li class="paginate_button active" aria-controls="dynamic-table" tabindex="0"><a href="#">1</a></li><li class="paginate_button " aria-controls="dynamic-table" tabindex="0"><a href="#">2</a></li><li class="paginate_button " aria-controls="dynamic-table" tabindex="0"><a href="#">3</a></li><li class="paginate_button next" aria-controls="dynamic-table" tabindex="0" id="dynamic-table_next"><a href="#">Next</a></li></ul></div></div></div></div>-->


                            </div>
                        </div>
                    </div>

                    <!-- Tab 3: Applying clearfix -->
                    <div class="tab-pane" id="3a">
                        <div class="row">
                            <div class="col-xs-12">
                                <table id="myTable1" class="table table-striped table-bordered table-hover">
                                    <!--                                    <div id="dynamic-table_wrapper" class="dataTables_wrapper form-inline no-footer"><div class="row"><div class="col-xs-6"><div class="dataTables_length" id="dynamic-table_length"><label>Display <select name="dynamic-table_length" aria-controls="dynamic-table" class="form-control input-sm" jf-ext-cache-id="28"><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> records</label></div></div><div class="col-xs-6"><div id="dynamic-table_filter" class="dataTables_filter"><label>Search:<input type="search" class="form-control input-sm" placeholder="" aria-controls="dynamic-table" jf-ext-cache-id="15"></label></div></div></div><table id="dynamic-table" class="table table-striped table-bordered table-hover dataTable no-footer DTTT_selectable" role="grid" aria-describedby="dynamic-table_info">-->

                                    <thead>
                                    <tr>
                                        <th style="width: 50px;text-align: center;">STT</th>
                                        <th style="width: 40px;text-align: center;">Xử Lý</th>
                                        <th style="width: 80px;text-align: center;">Ngày nhập viện</th>
                                        <th style="width: 80px;text-align: center;">Ngày xuất viện</th>
                                        <th style="width: 90px;text-align: center;" class="hidden-480"> Bác Sĩ</th>
                                        <th style="width: 100px;text-align: center;">Chẩn đoán</th>


                                    </tr>
                                    </thead>
                                    <tbody>
                                    <!-- Iterate over the patients list -->
                                    <tr th:each="admission, iterStat : ${admissions}">
                                        <td th:text="${iterStat.count}" style="text-align: center;"></td><!-- Row number -->
                                        <td>
                                            <div class="btn-group">

                                                <button data-toggle="dropdown" class="btn btn-sm btn-primary dropdown-toggle" jf-ext-button-ct="danger" aria-expanded="false">
                                                    <i class="ace-icon fa fa-cog "></i>

                                                    <i class="ace-icon fa fa-angle-down icon-on-right"></i>
                                                </button>

                                                <ul class="dropdown-menu dropdown-primary">


                                                    <li>
                                                        <a href="#" data-toggle="modal" th:data-target="${'#editAdmissionModal' + admission.ID}">
                                                            <i class="ace-icon fa fa-pencil "></i> Chi tiết
                                                        </a>
                                                    </li>


                                                    <li>
                                                        <a href="#">
                                                            <i class="ace-icon fa fa-trash-o "></i>
                                                            Xóa
                                                        </a>
                                                    </li>


                                                </ul>

                                                <div class="modal fade" th:id="${'editAdmissionModal' + admission.ID}" tabindex="-1" role="dialog" aria-labelledby="'modalLabel' + ${adminssion.ID}" aria-hidden="true">
                                                    <div class="modal-dialog" role="document">
                                                        <div class="modal-content">
                                                            <ul class="nav nav-tabs">
                                                                <li class="active">
                                                                    <a href="#1t" data-toggle="tab">Thông tin</a>
                                                                </li>
                                                                <li><a href="#2t" data-toggle="tab">Quá trình điều trị</a></li>

                                                            </ul>



                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" th:id="'modalLabel' + ${admission.ID}">Edit Examination </h5>
                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                        <span aria-hidden="true">&times;</span>
                                                                    </button>


                                                                </div>


                                                                <div class="modal-body">

                                                                    <div id="exTab2"class="container-fluid">
                                                                        <div class="tab-content clearfix">
                                                                            <!-- Tab 1: Overview -->
                                                                            <div class="tab-pane active" id="1t">
                                                                                <form th:action="@{/editAdmission(id=${admission.ID})}" method="post">
                                                                                    <!-- Hidden input for Examination ID -->
                                                                                    <input type="hidden" name="admissionId" th:value="${admission.ID}" />



                                                                                    <div class="form-group">
                                                                                        <label  for="admissionDoctorId">Bác sĩ:</label>

                                                                                        <select class="chosen-select form-control" id="admissionDoctorId" name="admissionDoctorId" required>
                                                                                            <option value="">...</option>
                                                                                            <option th:each="doctor : ${doctors}"
                                                                                                    th:value="${doctor.ID}"
                                                                                                    th:text="${'Bs. ' + doctor.firstName + ' ' + doctor.lastName}"
                                                                                                    th:selected="${doctor.ID == admission.doctor.ID }">
                                                                                            </option>
                                                                                        </select>
                                                                                    </div>


                                                                                    <div class="form-group">
                                                                                        <label  for="nurseId">Y tá:</label>

                                                                                        <select class="chosen-select form-control" id="nurseId" name="nurseId" required>
                                                                                            <option value="">...</option>
                                                                                            <option th:each="nurse : ${nurses}"
                                                                                                    th:value="${nurse.ID}"
                                                                                                    th:text="${'Y tá. ' + nurse.firstName + ' ' + nurse.lastName}"
                                                                                                    th:selected="${nurse.ID == admission.nurse.ID }">
                                                                                            </option>
                                                                                        </select>
                                                                                    </div>

                                                                                    <div class="form-group">
                                                                                        <label for="dateAdmission">Ngày khám</label>
                                                                                        <input type="date" class="form-control" th:value="${#dates.format(admission.dateAdmission, 'yyyy-MM-dd')}" id="dateAdmission" name="dateAdmission" required />
                                                                                    </div>


                                                                                    <div class="form-group">

                                                                                        <label for="dateOfDischarge">Ngày tái khám</label>
                                                                                        <input type="date" class="form-control" th:value="${#dates.format(admission.dateOfDischarge, 'yyyy-MM-dd')}" id="dateOfDischarge" name="dateOfDischarge" />
                                                                                    </div>

                                                                                    <div class="form-group">
                                                                                        <label for="admissionDiagnosis">Chẩn Đoán:</label>
                                                                                        <input type="text" class="form-control" th:value="${admission.diagnosis}" id="admissionDiagnosis" name="admissionDiagnosis" required />
                                                                                    </div>





                                                                                    <!--                                                                    <select id="medicationTemplate"   style="display: none;">-->
                                                                                    <!--                                                                        <option value="">Chọn thuốc</option>-->
                                                                                    <!--                                                                        <option th:each="medical : ${medications}"-->
                                                                                    <!--                                                                                th:value="${medical.ID}"-->
                                                                                    <!--                                                                                th:data-price="${medical.price}"-->
                                                                                    <!--                                                                                th:text="${medical.name + '-' + medical.effect}">-->
                                                                                    <!--                                                                        </option>-->
                                                                                    <!--                                                                    </select>-->

                                                                                    <!--                                                                    <table class="table table-bordered medicationTable">-->
                                                                                    <!--                                                                        <thead class="thead-light">-->
                                                                                    <!--                                                                        <tr >-->
                                                                                    <!--                                                                            <th>Tên thuốc</th>-->
                                                                                    <!--                                                                            <th>Giá</th>-->

                                                                                    <!--                                                                            <th>Số lượng</th>-->
                                                                                    <!--                                                                            <th> <button type="button" class="btn btn-primary btn-sm" th:attr="onclick='addNewRow(' + ${examination.ID} + ');'">Thêm mới</button></th>-->
                                                                                    <!--                                                                        </tr>-->
                                                                                    <!--                                                                        </thead>-->
                                                                                    <!--                                                                        <tbody th:id="'medicationBody-' + ${examination.ID}">-->
                                                                                    <!--                                                                        <tr th:each="examinationMedication : ${examination.examinationMedications}">-->
                                                                                    <!--                                                                            <td>-->
                                                                                    <!--                                                                                <select class="chosen-select form-control" name="medicationId" data-placeholder="Chọn thuốc" onchange="updatePrice(this)">-->
                                                                                    <!--                                                                                    <option value="">Chọn thuốc</option>-->
                                                                                    <!--                                                                                    <option th:each="medical : ${medications}"-->
                                                                                    <!--                                                                                            th:value="${medical.ID}"-->
                                                                                    <!--                                                                                            th:data-price="${medical.price}"-->
                                                                                    <!--                                                                                            th:text="${medical.name + '-' + medical.effect}"-->
                                                                                    <!--                                                                                            th:selected="${medical.ID == examinationMedication.medication.ID}">-->
                                                                                    <!--                                                                                    </option>-->
                                                                                    <!--                                                                                </select>-->
                                                                                    <!--                                                                            </td>-->
                                                                                    <!--                                                                            <td>-->
                                                                                    <!--                                                                                <input type="number" class="form-control" name="price" th:value="${examinationMedication.price}" placeholder="Enter Price">-->
                                                                                    <!--                                                                            </td>-->
                                                                                    <!--                                                                            <td>-->
                                                                                    <!--                                                                                <input type="number" class="form-control" name="quantity" th:value="${examinationMedication.quantity}" placeholder="Enter Quantity">-->
                                                                                    <!--                                                                            </td>-->
                                                                                    <!--                                                                            <td>-->
                                                                                    <!--                                                                                <button type="button" class="btn btn-danger btn-sm remove-row" onclick="removeRow(this)">Xóa</button>-->
                                                                                    <!--                                                                            </td>-->
                                                                                    <!--                                                                        </tr>-->
                                                                                    <!--                                                                        </tbody>-->
                                                                                    <!--                                                                    </table>-->


                                                                                    <div class="form-group">
                                                                                        <label for="sickroom">Phòng bênh</label>
                                                                                        <select class="form-select form-control" id="sickroom" name="sickroom" required>
                                                                                            <option value="">Choose a sickroom...</option>
                                                                                            <option th:each="room : ${rooms}"
                                                                                                    th:value="${room.roomNo}"
                                                                                                    th:text="${'Phòng ' + room.roomName}"
                                                                                                    th:selected="${room.roomNo == admission.room.roomNo }">
                                                                                            </option>
                                                                                        </select>
                                                                                    </div>

                                                                                    <div class="form-group">
                                                                                        <label for="admissionFee">Phí khám</label>
                                                                                        <input type="number" step="0.01" class="form-control"  th:value="${admission.fee}" id="admissionFee" name="admissionFee"  />
                                                                                    </div>

                                                                                    <div class="form-group">
                                                                                        <label for="admissionTotal">Tổng phí khám</label>
                                                                                        <input type="number" step="0.01" class="form-control" id="admissionTotal" name="admissionTotal" required oninput="calculateFeeExamination()" />
                                                                                    </div>


                                                                                <div class="modal-footer">
                                                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                                                                </div>
                                                                                </form>
                                                                            </div>



                                                                            <div class="tab-pane " id="2t">
                                                                                <table id="treatmentTable" class="table table-striped table-bordered table-hover">
                                                                                    <!--                                    <div id="dynamic-table_wrapper" class="dataTables_wrapper form-inline no-footer"><div class="row"><div class="col-xs-6"><div class="dataTables_length" id="dynamic-table_length"><label>Display <select name="dynamic-table_length" aria-controls="dynamic-table" class="form-control input-sm" jf-ext-cache-id="28"><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> records</label></div></div><div class="col-xs-6"><div id="dynamic-table_filter" class="dataTables_filter"><label>Search:<input type="search" class="form-control input-sm" placeholder="" aria-controls="dynamic-table" jf-ext-cache-id="15"></label></div></div></div><table id="dynamic-table" class="table table-striped table-bordered table-hover dataTable no-footer DTTT_selectable" role="grid" aria-describedby="dynamic-table_info">-->

                                                                                    <thead>
                                                                                    <tr>
                                                                                        <th style="width: 70px;text-align: center;">STT</th>
                                                                                        <th style="width: 60px;text-align: center;">Xử Lý</th>
                                                                                        <th style="width: 160px;text-align: center;">Ngày bắt đầu</th>
                                                                                        <th style="width: 80px;text-align: center;">Ngày kết thúc</th>
                                                                                        <th style="width: 90px;text-align: center;" class="hidden-480">Trạng thái</th>


                                                                                    </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                    <!-- Iterate over the patients list -->
                                                                                    <tr th:each="treatment, iterStat : ${admission.treatments}">
                                                                                        <td th:text="${iterStat.count}" style="text-align: center;"></td><!-- Row number -->
                                                                                        <td>
                                                                                            <div class="btn-group">

                                                                                                <button data-toggle="dropdown" class="btn btn-sm btn-primary dropdown-toggle" jf-ext-button-ct="danger" aria-expanded="false">
                                                                                                    <i class="ace-icon fa fa-cog "></i>

                                                                                                    <i class="ace-icon fa fa-angle-down icon-on-right"></i>
                                                                                                </button>

                                                                                                <ul class="dropdown-menu dropdown-primary">


                                                                                                    <li>
                                                                                                        <a th:href="@{/edit/{id}(id=${patient.ID})}">
                                                                                                            <i class="ace-icon fa fa-pencil "></i>
                                                                                                            Chỉnh sửa
                                                                                                        </a>


                                                                                                    </li>


                                                                                                    <li>
                                                                                                        <a href="#">
                                                                                                            <i class="ace-icon fa fa-trash-o "></i>
                                                                                                            Xóa
                                                                                                        </a>
                                                                                                    </li>


                                                                                                </ul>
                                                                                            </div>

                                                                                        </td>

                                                                                        <td style="text-align: center;" class="hidden-480" th:text="${#dates.format(treatment.startDate, 'dd-MM-yyyy')}"></td> <!-- Birth date formatted -->
                                                                                        <td style="text-align: center;" class="hidden-480" th:text="${#dates.format(treatment.endDate, 'dd-MM-yyyy')}"></td> <!-- Birth date formatted -->
                                                                                        <td th:text="${treatment.result}"></td>
                                                                                    </tr>
                                                                                    </tbody>
                                                                                </table>
                                                                            </div>

                                                                    </div>
                                                                </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                                </td>
                                        <td style="text-align: center;" th:text="${#dates.format(admission.dateAdmission, 'dd-MM-yyyy')}" ></td> <!-- Patient name -->
                                        <td style="text-align: center;" th:text="${#dates.format(admission.dateOfDischarge, 'dd-MM-yyyy')}"></td> <!-- Patient gender -->
                                        <td style="text-align: left;" class="hidden-480" th:text="${'Bs.' +' '+ admission.doctor.firstName + ' ' + admission.doctor.lastName }"></td> <!-- Birth date formatted -->
                                        <td style="text-align: right;" th:text="${admission.fee}"></td> <!-- Address -->

                                    </tr>
                                    </tbody>
                                </table>
                                <br>

                                <!--                                <div class="row"><div class="col-xs-6"><div class="dataTables_info" id="dynamic-table_info" role="status" aria-live="polite">Showing 1 to 10 of 23 entries</div></div><div class="col-xs-6"><div class="dataTables_paginate paging_simple_numbers" id="dynamic-table_paginate"><ul class="pagination"><li class="paginate_button previous disabled" aria-controls="dynamic-table" tabindex="0" id="dynamic-table_previous"><a href="#">Previous</a></li><li class="paginate_button active" aria-controls="dynamic-table" tabindex="0"><a href="#">1</a></li><li class="paginate_button " aria-controls="dynamic-table" tabindex="0"><a href="#">2</a></li><li class="paginate_button " aria-controls="dynamic-table" tabindex="0"><a href="#">3</a></li><li class="paginate_button next" aria-controls="dynamic-table" tabindex="0" id="dynamic-table_next"><a href="#">Next</a></li></ul></div></div></div></div>-->


                            </div>
                        </div>
                    </div>

                    <!-- Tab 4: Background color -->

                </div>
            </div>






                <!-- filter -->

                <!-- LISTPATIENT			 -->


            </div>
        </div>
    </div>
</div>
<!--[if !IE]> -->
<script th:src="@{/admin/assets/js/jquery.2.1.1.min.js}"></script>

<script>
    function calculateFeeExamination() {
        const medicationBodies = document.querySelectorAll('.medicationTable tbody');
        let total = 0;
        medicationBodies.forEach(medicationBody => {
            const rows = medicationBody.querySelectorAll('tr');
            rows.forEach(row => {
                const price = parseFloat(row.querySelector('input[name="price"]').value) || 0;
                const quantity = parseInt(row.querySelector('input[name="quantity"]').value) || 0;
                total += price * quantity;
            });
        });
        document.getElementById('total').value = total.toFixed(2);
    }

    // Attach event listeners to automatically calculate when price or quantity changes
    document.querySelectorAll("#medicationBody input[name='price'], #medicationBody input[name='quantity']").forEach(input => {
        input.addEventListener("input", calculateFeeExamination);
    });
</script>
<script>
    function loadDistricts(cityId) {
        // Clear existing options
        const districtSelect = document.getElementById('districtId');
        districtSelect.innerHTML = '<option value="" disabled selected>Select a district</option>';

        // Fetch districts
        fetch(`/districts/${cityId}`)
            .then(response => response.json())
            .then(districts => {
                districts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district.districtId; // Adjust this if your field name is different
                    option.textContent = district.districtName; // Adjust to your attribute
                    districtSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error fetching districts:', error);
            });
    }

    function loadWards(districtId) {
        // Clear existing options
        const wardSelect = document.getElementById('wardId');
        wardSelect.innerHTML = '<option value="" disabled selected>Select a ward</option>';

        // Fetch wards
        fetch(`/wards/${districtId}`)
            .then(response => response.json())
            .then(wards => {
                wards.forEach(ward => {
                    const option = document.createElement('option');
                    option.value = ward.wardId; // Adjust this if your field name is different
                    option.textContent = ward.wardName; // Adjust to your attribute
                    wardSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error fetching wards:', error);
            });
    }
</script>


<!--<script>-->
<!--    $('#btnSubmit').click(function(event) {-->
<!--        event.preventDefault();-->
<!--        var data = {};-->
<!--        var formData = $('#patient-info-form').serializeArray();-->

<!--        $.each(formData, function() {-->
<!--            data[this.name] = this.value; // Convert array to object-->
<!--        });-->

<!--        // Log form data for debugging-->
<!--        console.log("Form Data:", data);-->

<!--        // Perform AJAX request to the API-->
<!--        $.ajax({-->
<!--            type: "POST",-->
<!--            url: "patient/add", // Make sure the URL matches the endpoint-->
<!--            data: JSON.stringify(data),-->
<!--            contentType: "application/json", // Important to specify JSON content-->
<!--            dataType: 'json', // Expect JSON response-->
<!--            success: function(response) {-->
<!--                console.log("Success:", response);-->
<!--                $('#postResultDiv').removeClass('alert-danger').addClass('alert-success'); // Set to success alert-->
<!--                $('#alertMessage').text(response.message); // Update the alert message-->
<!--                $('#addPatient').modal('hide');-->
<!--                $('#postResultDiv').show().addClass('alert-fixed');-->
<!--                // Reload the table content-->
<!--                $('#myTable').load(location.href + ' #myTable', function() {-->
<!--                    console.log("Table reloaded successfully");-->
<!--                });-->

<!--                setTimeout(function() {-->
<!--                    $('#postResultDiv').fadeOut();-->
<!--                }, 5000);-->

<!--                // Reset the form-->
<!--                $('#patient-info-form')[0].reset();-->

<!--            },-->
<!--            error: function(xhr, status, error) {-->
<!--                console.log("Failed:", status, error);-->
<!--                $('#postResultDiv').removeClass('alert-success').addClass('alert-danger'); // Set to danger alert-->
<!--                $('#alertMessage').text("Failed to add patient. Please check the console for more details."); // Update the alert message-->
<!--                $('#postResultDiv').show().addClass('alert-fixed');-->
<!--                setTimeout(function() {-->
<!--                    $('#postResultDiv').fadeOut(); // Fade out the alert-->
<!--                }, 5000);-->

<!--            }-->
<!--        });-->
<!--    });-->
<!--</script>-->





<!--[if IE]>
<script th:src="@{/admin/assets/js/jquery.1.11.1.min.js}"></script>
<![endif]-->

<!--[if !IE]> -->
<script type="text/javascript" th:src="@{/admin/assets/js/jquery.min.js}"></script>
<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script th:src='@{/assets/js/jquery1x.min.js}'><"+"/script>");
</script>
<![endif]-->
<script type="text/javascript">
    if('ontouchstart' in document.documentElement) document.write("<script th:src='@{/assets/js/jquery.mobile.custom.min.js}'><"+"/script>");
</script>
<script th:src="@{/admin/assets/js/bootstrap.min.js}"></script>

<!-- Page specific plugin scripts -->

<!--[if lte IE 8]>
<script th:src="@{/assets/js/excanvas.min.js}"></script>
<![endif]-->
<!--                    <script th:src="@{/assets/js/jquery-ui.custom.min.js}"></script>-->
<!--                    <script th:src="@{/assets/js/jquery.ui.touch-punch.min.js}"></script>-->
<!--                    <script th:src="@{/assets/js/jquery.easypiechart.min.js}"></script>-->
<!--                    <script th:src="@{/assets/js/jquery.sparkline.min.js}"></script>-->
<!--                    <script th:src="@{/assets/js/jquery.flot.min.js}"></script>-->
<!--                    <script th:src="@{/assets/js/jquery.flot.pie.min.js}"></script>-->
<!--                    <script th:src="@{/assets/js/jquery.flot.resize.min.js}"></script>-->

<!-- Ace scripts -->
<!--                    <script th:src="@{/assets/js/ace-elements.min.js}"></script>-->
<!--                    <script th:src="@{/assets/js/ace.min.js}"></script>-->
<script>
    // document.addEventListener("DOMContentLoaded", function() {
    //     // Set initial selection based on `data-selected-id`
    //     document.querySelectorAll("select[name='medicationId']").forEach(select => {
    //         const selectedId = select.getAttribute("data-selected-id");
    //         if (selectedId) {
    //             select.value = selectedId;
    //         }
    //     });
    // });

    function getFormDataAndSubmit(examinationId) {
        const formData = {
            Id: examinationId,
            doctorId: document.getElementById("doctorId").value,
            examinationDate: document.getElementById("examinationDate").value,
            diagnosis: document.getElementById("diagnosis").value,
            nextExaminationDate: document.getElementById("nextExaminationDate").value,
            fee: document.getElementById("fee").value,
            examinationMedications: [],
            medications: ""  // Add an empty string for medications
        };

        // Collect medication rows
        const medicationRows = document.querySelectorAll(`#medicationBody-${examinationId} tr`);
        const medicationIds = [];  // Array to store medication IDs for the comma-separated string

        medicationRows.forEach(row => {
            const medicationId = row.querySelector("select[name='medicationId']").value;
            const price = row.querySelector("input[name='price']").value;
            const quantity = row.querySelector("input[name='quantity']").value;

            if (medicationId && price && quantity) {
                // Add the medicationId to the list for the comma-separated string
                medicationIds.push(medicationId);

                // Add medication details to the examinationMedications array
                formData.examinationMedications.push({
                    medicationId: medicationId,
                    price: parseFloat(price),
                    quantity: parseInt(quantity)
                });
            }
        });

        // Set the medications attribute as a comma-separated string of medication IDs
        formData.medications = medicationIds.join(',');

        // Call the API using AJAX
        $.ajax({
            url: `examination/edit?id=${examinationId}`,  // Use the appropriate endpoint
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function(response) {
                alert("Examination updated successfully!");
                // Optionally, you can refresh the data or close the modal
                $('#editExaminationModal').modal('hide');
            },
            error: function(error) {
                alert("An error occurred while updating the examination. Please try again.");
            }
        });
    }



    function addNewRow(examinationId) {

        const medicationBody = document.getElementById(`medicationBody-${examinationId}`);
        console.log(`Trying to access: medicationBody-${examinationId}`, medicationBody); // Debugging log
        if (!medicationBody) {
            console.error(`Element with ID 'medicationBody-${examinationId}' not found!`);
            return; // Exit the function if the element is not found
        }
        const medicationTemplate = document.getElementById('medicationTemplate');

        // Create a new row
        const newRow = document.createElement('tr');

        // Create the cells for the new row
        newRow.innerHTML = `
        <td>
            <select class="chosen-select form-control" name="medicationId" data-placeholder="Chọn thuốc" onchange="updatePrice(this)">
                <option value="">Chọn thuốc</option>
                ${Array.from(medicationTemplate.options).map(option => `
                    <option value="${option.value}" data-price="${option.getAttribute('data-price')}">${option.text}</option>
                `).join('')}
            </select>
        </td>
        <td>
            <input type="number" class="form-control" name="price" placeholder="Enter Price">
        </td>
        <td>
            <input type="number" class="form-control" name="quantity" placeholder="Enter Quantity">
        </td>
        <td>
            <button type="button" class="btn btn-danger btn-sm remove-row" onclick="removeRow(this)">Xóa</button>
        </td>
    `;

        // Append the new row to the medication body
        medicationBody.appendChild(newRow);
    }
    // Remove row from the table
    function removeRow(button) {
        $(button).closest('tr').remove();  // Remove the specific row
        calculateFeeExamination();
    }

    // Update price in the row based on selected medication
    function updatePrice(select) {
        const selectedOption = select.options[select.selectedIndex];
        const priceInput = select.closest('tr').querySelector('input[name="price"]');
        priceInput.value = selectedOption.dataset.price;
        calculateFeeExamination();
    }


    // Handle form submission
    $('#examination-info-form').submit(function(e) {
        e.preventDefault();  // Prevent form from refreshing the page

        // Gather form data
        var formData = {
            doctorId: $('#doctorId').val(),
            examinationDate: $('#examinationDate').val(),
            diagnosis: $('#diagnosis').val(),
            medications: []
        };

        // Gather table data
        $('#medicationTable tbody tr').each(function() {
            var medication = {
                medicationName: $(this).find('input[name="medicationName"]').val(),
                dosage: $(this).find('input[name="dosage"]').val(),
                frequency: $(this).find('input[name="frequency"]').val()
            };
            formData.medications.push(medication);
        });

        // Send data to the backend via AJAX
        $.ajax({
            url: '/api/examinations',  // The URL of the API to handle form submission
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function(response) {
                alert('Examination saved successfully!');
                // Reset the form after successful submission
                $('#examination-info-form')[0].reset();
                $('#medicationBody').html('');  // Clear the table
            },
            error: function(error) {
                console.error('Error saving the examination:', error);
            }
        });
    });

</script>
</body>
</html>
